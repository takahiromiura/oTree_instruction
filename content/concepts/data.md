+++
draft = false
title = '実験・データ・oTree'
weight = 3
math = true
+++

そもそも、なぜ実験をやるのでしょうか？
答えは簡単で、データを取得するためです。

実験中に得たデータは、後から見えるように保存しなければいけません。
oTree では RDB (Relational Database) に実験データを保存します。
RDB は、テーブルというエクセルのシートのような表を複数持ちます。また、キーという値でテーブル同士を紐づけられます。

どのようなデータを残しておくかは、実験デザイン、また実験者の裁量によります。
例えば、独裁者ゲームで独裁者が決めた配分額や、罰則付き公共財ゲームにおける罰の量だけでなく、選択までに何秒かかったかといった情報も欲しいかもしれません。

RDB のテーブルは、カラム (列) の名前とデータの型を事前に定義しておく必要があります。
例えば、独裁者の配分額は `transfer_amount` という名前が良いでしょう。
また、このデータは数値型になると思います。
しかし、チャットのようなテキストデータを保存したいのであれば、文字列型として定義する必要があります。

oTree では、ORM (Object-Relational Mapping) モデルというのが重要になってきます。
これは、Python が RDB とやりとりするためのクラスです。
エンティティなどとも呼ばれます。

次のコードは ORM モデルの例です。

```py
class Player(BasePlayer):
    transfer_amount = models.IntegerField()
```

このように定義すると、`Player` テーブルに `transfer_amount` という数値型のカラムを定義することができます。
ORM モデルでは、このカラムのことを **フィールド** (Field) と呼びます。
加えて、このクラスを使ってデータベースにデータを追加、更新、また取り出すことができます。

{{% notice style="note" title="ORM モデルの作成" %}}
ORM モデルを作るには ORM ベースクラスを継承します。
上の例では、`BasePlayer` というのがそれにあたります。
{{% /notice %}}

したがって、oTree を理解するには、この ORM モデルがどのように扱われているかを見る必要があります。
そして実験デザインを oTree で実装するためには、ORM モデルをどのように設計するかが鍵となります。