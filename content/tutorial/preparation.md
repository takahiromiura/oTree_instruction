+++
title = "実装前の準備"
weight = 1
draft = false
math = true
+++

oTree で実験プログラムを作成する前に、実験デザインをプログラムに落とし込む準備をしましょう。
ここでは以下のことを整理します。

1. 実験デザインを決める
2. 実験の手順を細かく書き出す
3. 各手順について、実装に必要な情報を整理する

## 実験デザイン

実験プログラムを作るには、まず実験デザインを決める必要があります。
この例では、実験デザインとして最もシンプルな形の独裁者ゲームを考えます。

- 参加者数は $N$ (= $2n$)
- 独裁者ゲームは各セッションで 1 回のみ
- 独裁者ゲームの手順
  - ランダムに $n$ 個のペアを作成
  - ペア内でランダムに役割を割り当て
    - 参加者は自分の役割を知ることができる
  - 独裁者役は初期保有量 $\omega$ を受け取り、その中から $x \in \{0, 1, ..., \omega\}$ を受け手役に分配する
- 報酬は参加報酬 + ゲームの結果
  - 各参加者は自分のグループ (ペア) の結果のみ知ることができる

## 手順の分解

独裁者ゲームの手順をできるだけ細かく分解すると、次のようにできます。

1. 実験の説明を行う
2. 実験参加者でランダムにペアを作成する
3. ペアの内 1 人が独裁者役、もう 1 人は受け手役に割り当てる
4. 参加者に自分の役割情報を開示する
5. 独裁者役は初期保有量 $\omega$ を受け取り、相手への配分額 $x$ を決める
6. 独裁者役の報酬、受け手役の報酬を計算する
7. 各参加者に自グループの結果と報酬額を提示する

## 各手順の整理

実験の手順を整理したうえで、各手順について以下の観点で整理していきます。

- **パラメータ**: 事前に決めておくべき値
- **アクション**: プログラムや参加者が行う操作
- **データ**: 記録しておく値
  - データの名前、型、格納先（`Player`, `Group` など）
- **ページ**: 参加者に見せる画面
  - 画面が必要か、誰が見るか、入力があるか

### 手順 1: 実験説明

この例では、実験説明は実験室内で紙として配布すると仮定します。
oTree で実装する必要はありません。

- **パラメータ**: なし
- **アクション**: なし
- **データ**: なし
- **ページ**: 画面の必要なし

### 手順 2: ペア作成

参加者をランダムにペア (グループ) に分けます。
よって、グループサイズの設定とペアの割当を行う必要があります。
参加者に画面を表示する必要はないでしょう。

- **パラメータ**: グループサイズ (この例では 2)
- **アクション**: グループ分け (プログラム)
- **データ**: なし
- **ページ**: 画面の必要なし

### 手順 3: 役割の割当

割り当てたペア内で独裁者役と受け手役をランダムに割り当てます。
ここも、参加者に画面を表示する必要はありません。

- **パラメータ**: 役割の名前 (独裁者、受け手)
- **アクション**: 役割割り当て (プログラム)
- **データ**: なし
- **ページ**: 画面の必要なし

{{% notice style="info" title="グループと役割の割り当て" %}}
グループや役割の割り当てには複数の方法があります。
詳細は[グループと役割の割り当て](../../guide/group-assignment/)を参照してください。
{{% /notice %}}

### 手順 4: 役割情報の開示

各参加者に割り当てられた役割を画面で表示します。
参加者が入力するものはありません。

- **パラメータ**: なし
- **アクション**: なし
- **データ**: なし
- **ページ**: 必要あり (対象: 全員、入力: なし)

### 手順 5: 独裁者役の選択

独裁者役が配分額 $x$ を選択します。
また、この画面は独裁者役のみに表示します。

この例では独裁者は 0 から初期保有量までの整数しか選択できないため、選択範囲を指定しておく必要があります。
選択結果は `allocated_amount` というフィールド名で `Group` に整数型として格納します。
グループ全体で共有する値のため、`Group` を格納先とします。

- **パラメータ**: 初期保有量 $\omega$ (例: 10)、配分額の範囲 (0 から $\omega$ の整数)
- **アクション**: 配分額の入力 (参加者・独裁者)
- **データ**: 配分額
  - 名前: `allocated_amount`
  - データ型: 整数
  - 格納先: `Group` に保存
- **ページ**: 必要あり
  - 対象: 独裁者のみ
  - 入力: あり (配分額)

### 手順 6: 報酬の計算

初期保有量と独裁者役の配分額から、各参加者の報酬額を計算します (独裁者の報酬: $\omega - x$, 受け手の報酬: $x$)。
参加者に画面を表示する必要はありません。

- **パラメータ**: なし
- **アクション**: 報酬計算 (プログラム)
- **データ**: なし
- **ページ**: 画面の必要なし

### 手順 7: 結果の提示

各参加者に結果と報酬を表示します。

- **パラメータ**: なし
- **アクション**: なし
- **データ**: なし
- **ページ**: 必要あり (対象: 全員、入力: なし)

## まとめ

各手順で整理した内容をまとめます。

### 設定すべきパラメータ

| パラメータ | 値 |
|-----------|-----|
| グループサイズ | 2 |
| 役割の名前 | 独裁者、受け手 |
| 初期保有量 $\omega$ | 10 |
| 配分額の範囲 | 0 から $\omega$ の整数 |

### 必要なアクション

| 誰が | 何を |
|-----|------|
| プログラム | グループ分け |
| プログラム | 役割割り当て |
| 参加者 (独裁者) | 配分額の入力 |
| プログラム | 報酬計算 |

### 保存すべきデータ

| 内容 | フィールド名 | 型 | 格納先 |
|-----|-------------|---|-------|
| 配分額 | `allocated_amount` | 整数 | `Group` |

### ページ設計

実験で参加者に見せる画面（ページ）を、手順の順序に沿って示します。

| ページ | 対応する手順 | 内容 | 対象 |
|--------|-------------|------|------|
| 役割情報ページ | 手順 4 | 参加者に自分の役割を表示 | 全員 |
| 選択ページ | 手順 5 | 独裁者役が配分額を入力 | 独裁者のみ |
| 結果ページ | 手順 7 | 各参加者に結果と報酬を表示 | 全員 |

手順のうち、ページとして実装しないものもあります。

- 手順 1 (実験説明)
- 手順 2, 3 (ペア作成・役割割当)
- 手順 6 (報酬計算)

次のページでは、oTree プロジェクトを作成し、実際にコードを書いていきます。